---
interface Props {
  id: number;
  nombre: string;
  descripcion: string;
  imagen: string;
  whatsappMsg: string;
}

const { id, nombre, descripcion, imagen, whatsappMsg } = Astro.props;
const whatsappLink = `https://wa.me/51995010281?text=${encodeURIComponent(whatsappMsg)}`;
---

<div class="group reveal">
  <div class="vehicle-card relative bg-dark-lighter rounded-2xl overflow-hidden shadow-xl transition-[transform,box-shadow] duration-300 hover:shadow-2xl hover:shadow-primary/20 hover:-translate-y-2 will-change-transform cursor-pointer" data-vehicle-id={id}>
    <!-- Image Container -->
    <div class="relative h-56 overflow-hidden">
      <img 
        src={imagen} 
        alt={nombre}
        class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105 will-change-transform"
        loading="lazy"
        decoding="async"
      />
      <div class="absolute inset-0 bg-gradient-to-t from-dark-lighter via-transparent to-transparent opacity-60"></div>
      
      <!-- Badge -->
      <div class="absolute top-4 right-4 bg-primary text-white px-3 py-1 rounded-full text-sm font-semibold">
        Disponible
      </div>
    </div>
    
    <!-- Content -->
    <div class="p-6">
      <h3 class="text-xl font-bold text-white mb-2 group-hover:text-primary transition-colors duration-300">
        {nombre}
      </h3>
      <p class="text-gray-400 text-sm leading-relaxed line-clamp-2">
        {descripcion}
      </p>
      
      <!-- CTA -->
      <div class="mt-4">
        <button class="btn-ver-detalles flex items-center gap-2 text-primary hover:text-primary-light transition-colors font-medium">
          <span>Ver detalles</span>
          <i class="fas fa-arrow-right text-sm transition-transform group-hover:translate-x-1"></i>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div id={`modal-${id}`} class="vehicle-modal fixed inset-0 z-[100] hidden items-center justify-center p-4 bg-black/80 backdrop-blur-sm">
  <div class="modal-content bg-dark-lighter rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl transform scale-95 opacity-0 transition-all duration-300">
    <!-- Modal Header -->
    <div class="relative">
      <img 
        src={imagen} 
        alt={nombre}
        class="w-full h-64 object-cover"
      />
      <button class="btn-close-modal absolute top-4 right-4 w-10 h-10 bg-dark/80 rounded-full flex items-center justify-center text-white hover:bg-primary transition-colors">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <!-- Modal Body -->
    <div class="p-6">
      <h2 class="text-2xl font-bold text-white mb-4">{nombre}</h2>
      <p class="text-gray-300 leading-relaxed mb-6">{descripcion}</p>
      
      <!-- WhatsApp Button -->
      <a 
        href={whatsappLink}
        target="_blank"
        rel="noopener noreferrer"
        class="inline-flex items-center gap-3 bg-[#25d366] hover:bg-[#20bd5a] text-white font-semibold px-6 py-3 rounded-full transition-colors duration-300"
      >
        <i class="fab fa-whatsapp text-xl"></i>
        <span>Consultar por WhatsApp</span>
      </a>
    </div>
  </div>
</div>

<script define:vars={{ id }}>
  document.addEventListener('DOMContentLoaded', () => {
    const card = document.querySelector(`[data-vehicle-id="${id}"]`);
    const modal = document.getElementById(`modal-${id}`);
    const modalContent = modal?.querySelector('.modal-content');
    const btnClose = modal?.querySelector('.btn-close-modal');
    
    function openModal() {
      modal?.classList.remove('hidden');
      modal?.classList.add('flex');
      setTimeout(() => {
        modalContent?.classList.remove('scale-95', 'opacity-0');
        modalContent?.classList.add('scale-100', 'opacity-100');
      }, 10);
      document.body.style.overflow = 'hidden';
    }
    
    function closeModal() {
      modalContent?.classList.remove('scale-100', 'opacity-100');
      modalContent?.classList.add('scale-95', 'opacity-0');
      setTimeout(() => {
        modal?.classList.remove('flex');
        modal?.classList.add('hidden');
      }, 300);
      document.body.style.overflow = '';
    }
    
    card?.addEventListener('click', openModal);
    btnClose?.addEventListener('click', (e) => {
      e.stopPropagation();
      closeModal();
    });
    
    modal?.addEventListener('click', (e) => {
      if (e.target === modal) closeModal();
    });
  });
</script>
